<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Send Position to Blockchain</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body>
  <h2>ğŸ›° ìœ„ì¹˜ë¥¼ ë¸”ë¡ì²´ì¸ì— ì „ì†¡ ì¤‘...</h2>
  <div id="status" style="color:red;"></div>

  <script>
    // âœ… 1. Remixì—ì„œ ë°°í¬í•œ ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ
    const contractAddress = "0x4AE69DfF9A7948566E7263Ed35072880EC2FDAD9"; // â† ìˆ˜ì • í•„ìš”

    // âœ… 2. Remixì—ì„œ ë³µì‚¬í•œ ABI ë¶™ì—¬ë„£ê¸°
    const abi = [
	
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "string",
				"name": "pos",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"name": "PositionUpdated",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "pos",
				"type": "string"
			}
		],
		"name": "updatePosition",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}

];

    // âœ… 3. URLì—ì„œ ì „ë‹¬ëœ ì¢Œí‘œ ë¬¸ìì—´ ì¶”ì¶œ (?pos=...)
    const urlParams = new URLSearchParams(window.location.search);
    const pos = urlParams.get("pos");

    if (!pos) {
      document.getElementById("status").innerText = "âŒ ì¢Œí‘œê°’ì´ ì—†ìŠµë‹ˆë‹¤.";
      throw new Error("Missing ?pos= parameter in URL");
    }

    window.onload = async () => {
      if (typeof window.ethereum === "undefined") {
        alert("ğŸ¦Š MetaMaskë¥¼ ì„¤ì¹˜í•´ì£¼ì„¸ìš”!");
        return;
      }

      const web3 = new Web3(window.ethereum);

      try {
        await window.ethereum.request({ method: "eth_requestAccounts" });
        const accounts = await web3.eth.getAccounts();

        // âœ… ì „ì—­ìœ¼ë¡œ contract ì„ ì–¸í•˜ë©´ ì½˜ì†”ì—ì„œë„ ì ‘ê·¼ ê°€ëŠ¥
        window.contract = new web3.eth.Contract(abi, contractAddress);

        console.log("ğŸ“¦ ì¢Œí‘œ:", pos);
        console.log("ğŸ‘› ê³„ì •:", accounts[0]);
        console.log("ğŸ“¡ contract.methods:", contract.methods);

        await contract.methods.updatePosition(pos).send({
          from: accounts[0]
        });

        document.getElementById("status").style.color = "green";
        document.getElementById("status").innerText = "âœ… ë¸”ë¡ì²´ì¸ ì „ì†¡ ì„±ê³µ!";
      } catch (error) {
        console.error("âŒ ì˜¤ë¥˜:", error);
        document.getElementById("status").innerText = "âŒ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ!";
      }
    };
  </script>
</body>
</html>
