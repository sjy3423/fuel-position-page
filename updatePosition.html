<!DOCTYPE html>
<html>
<head>
  <title>Send Position to Blockchain</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body>
  <h2>ğŸ›° ìœ„ì¹˜ë¥¼ ë¸”ë¡ì²´ì¸ì— ì „ì†¡ ì¤‘...</h2>
  <script>
    window.onload = async () => {
      // 1. URLì—ì„œ ì¢Œí‘œ ë¬¸ìì—´ ë°›ê¸°
      const urlParams = new URLSearchParams(window.location.search);
      const pos = urlParams.get("pos");

      // 2. MetaMask ìˆëŠ”ì§€ í™•ì¸
      if (typeof window.ethereum === "undefined") {
        alert("MetaMaskë¥¼ ì„¤ì¹˜í•´ì£¼ì„¸ìš”!");
        return;
      }

      // 3. ì§€ê°‘ ì—°ê²° ìš”ì²­
      const accounts = await ethereum.request({ method: "eth_requestAccounts" });
      const web3 = new Web3(window.ethereum);

      // 4. ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ + ABI
      const contractAddress = "0x4f97ed71fe42775c3854B0f5a686073284d8F9eD"; // <-- STEP 5ì—ì„œ ë°”ê¿”ì•¼ í•´ìš”!
      const abi = [
        {
          "inputs": [{ "internalType": "string", "name": "pos", "type": "string" }],
          "name": "updatePosition",
          "outputs": [],
          "stateMutability": "nonpayable",
          "type": "function"
        }
      ];

      const contract = new web3.eth.Contract(abi, contractAddress);

      // 5. íŠ¸ëœì­ì…˜ ë³´ë‚´ê¸°
      try {
        const tx = await contract.methods.updatePosition(pos).send({ from: accounts[0] });
        console.log("âœ… ì „ì†¡ ì„±ê³µ:", tx);
        document.body.innerHTML += `<p style="color:green;">âœ” ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë¨!</p>`;
      } catch (err) {
        console.error("âŒ ì „ì†¡ ì‹¤íŒ¨:", err);
        document.body.innerHTML += `<p style="color:red;">âŒ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ!</p>`;
      }
    };
  </script>
</body>
</html>