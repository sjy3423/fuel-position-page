<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Send Position to Blockchain</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body>
  <h2>ğŸ›° ìœ„ì¹˜ë¥¼ ë¸”ë¡ì²´ì¸ì— ì „ì†¡ ì¤‘...</h2>
  <div id="status" style="color: red;"></div>

  <script>
    // ğŸ“Œ Remixì—ì„œ ë³µì‚¬í•œ ì‹¤ì œ ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œë¥¼ ì—¬ê¸°ì— ì…ë ¥
    const contractAddress = "0x4f97ed71fe42775c3854B0f5a686073284d8F9eD";  // â† ë‹¹ì‹ ì´ ë°°í¬í•œ Sepolia ì£¼ì†Œë¡œ ë°”ê¾¸ì„¸ìš”

    // ğŸ“Œ updatePosition(string) ABIë§Œ í¬í•¨
    const abi = 
      
       [
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "string",
				"name": "pos",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"name": "PositionUpdated",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "pos",
				"type": "string"
			}
		],
		"name": "updatePosition",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	

      }
    ];

    // ğŸ§  URLì—ì„œ pos íŒŒë¼ë¯¸í„° ì½ê¸°
    const urlParams = new URLSearchParams(window.location.search);
    const pos = urlParams.get("pos");

    if (!pos) {
      document.getElementById("status").innerText = "âŒ ì¢Œí‘œ ì •ë³´ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.";
      throw new Error("Missing ?pos= parameter in URL");
    }

    // ğŸŒ ì›¹3 ì—°ë™ ë° ì „ì†¡
    window.onload = async () => {
      if (typeof window.ethereum === "undefined") {
        alert("MetaMaskë¥¼ ì„¤ì¹˜í•´ì£¼ì„¸ìš”!");
        return;
      }

      const web3 = new Web3(window.ethereum);
      await window.ethereum.request({ method: "eth_requestAccounts" });

      const accounts = await web3.eth.getAccounts();
      const contract = new web3.eth.Contract(abi, contractAddress);

      try {
        await contract.methods.updatePosition(pos).send({
          from: accounts[0]
        });

        document.getElementById("status").style.color = "green";
        document.getElementById("status").innerText = "âœ… ë¸”ë¡ì²´ì¸ ì „ì†¡ ì„±ê³µ!";
      } catch (error) {
        console.error("ì „ì†¡ ì˜¤ë¥˜:", error);
        document.getElementById("status").style.color = "red";
        document.getElementById("status").innerText = "âŒ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ!";
      }
    };
  </script>
</body>
</html>
